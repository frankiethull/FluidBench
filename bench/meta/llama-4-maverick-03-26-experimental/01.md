A lovely problem! Let's dive into simulating the 1D Advection equation, storing the results, and visualizing them as a Space-Time Heatmap using R and ggplot2. Here's the step-by-step solution:

**Problem 1: The "Space-Time" Waterfall (1D Advection)**
===========================================================

**Theory Quick Recap**
------------------------

The 1D Linear Advection equation is given by:

∂u/∂t + c ∂u/∂x = 0

where:
- `u = u(x,t)` is the wave amplitude at position `x` and time `t`,
- `c` is the constant advection velocity (set to 1 in our case),
- `x ∈ [0,2]` is the spatial domain,
- Periodic boundary conditions are applied: `u(0,t) = u(2,t)`.

This equation describes a wave moving at speed `c` without changing shape.

**R Script**
-------------

Here's the complete R script to simulate and visualize the 1D Advection:

```r
# Load necessary libraries
library(ggplot2)
library(dplyr)

# Parameters
c <- 1          # Advection velocity
L <- 2          # Domain length (x ∈ [0, L])
T <- 2          # Total simulation time
Nx <- 200       # Number of spatial grid points
Nt <- 200       # Number of time steps
dx <- L / (Nx - 1) # Spatial step size
dt <- T / (Nt - 1) # Time step size

# Ensure stability (CFL condition: c*dt/dx <= 1)
if (c * dt / dx > 1) {
  stop("CFL condition violated. Reduce dt or increase dx.")
}

# Grid: x (space) and t (time)
x_grid <- seq(0, L, length.out = Nx)
t_grid <- seq(0, T, length.out = Nt)

# Initialize matrix to store u(x,t) at all times
# Dimension: Nt rows (time) × Nx columns (space)
u_matrix <- matrix(0, nrow = Nt, ncol = Nx)

# Initial condition (Gaussian pulse centered at x = 1)
u_matrix[1, ] <- exp(-((x_grid - 1) / 0.1)^2)

# 1D Advection Solver (Finite Difference Upwind Method)
for (t_idx in 1:(Nt - 1)) {
  for (x_idx in 1:Nx) {
    # Periodic boundary handling
    x_prev <- ifelse(x_idx == 1, Nx, x_idx - 1) # Wrap around for x=0
    u_matrix[t_idx + 1, x_idx] <- u_matrix[t_idx, x_idx] - 
      (c * dt / dx) * (u_matrix[t_idx, x_idx] - u_matrix[t_idx, x_prev])
  }
}

# Reshape data for ggplot (long format: columns for x, t, u)
df_plot <- expand.grid(x = x_grid, t = t_grid) %>%
  mutate(u = as.vector(u_matrix))

# Space-Time Heatmap (ggplot2)
ggplot(df_plot, aes(x = x, y = t, fill = u)) +
  geom_raster(interpolate = TRUE) +
  scale_fill_viridis_c(option = "plasma") +
  labs(
    title = "Space-Time Heatmap of 1D Advection (Gaussian Pulse)",
    subtitle = "∂u/∂t + c ∂u/∂x = 0, c = 1, Periodic Boundaries",
    x = "Space (x)", y = "Time (t)", fill = "Amplitude (u)"
  ) +
  theme_minimal() +
  theme(legend.position = "right")
```

**How It Works**
------------------

1. **Setup**:
   - Define `c`, domain `L`, simulation time `T`, and discretization parameters `Nx` and `Nt`.
   - Compute `dx` and `dt`, ensuring the **CFL condition** (`c * dt / dx ≤ 1`) for stability.

2. **Initialization**:
   - Create grids for `x` and `t`.
   - Allocate a matrix `u_matrix` (dimensions `Nt × Nx`) to store the solution `u(x,t)` at all time steps.
   - Set the initial condition: a Gaussian pulse `u(x,0) = exp(-((x-1)/0.1)^2)`.

3. **Numerical Solver** (Upwind Finite Difference):
   - Loop over time steps `t_idx = 1:Nt-1`.
   - For each `x_idx`, update `u(x,t+dt)` using:
     ```
     u_new = u_old - (c*dt/dx) * (u_old - u_left)
     ```
     where `u_left` is `u(x-dx,t)`. For `x=0`, we wrap around to `x=L` (periodic boundary).

4. **Data Reshaping**:
   - Convert the `u_matrix` into a long-format dataframe `df_plot` with columns `x`, `t`, and `u`.

5. **Visualization**:
   - Use `ggplot2::geom_raster()` to plot the Space-Time Heatmap.
   - `x` = Space, `y` = Time, `fill` = Amplitude `u`.
   - `scale_fill_viridis_c()` gives a smooth color gradient.

**Expected Output**
--------------------

When you run the script, you'll see a beautiful **diagonal stripe pattern** in the heatmap. This represents the Gaussian pulse traveling at speed `c = 1` through the periodic domain `[0,2]`. Here's how to interpret it:
- **X-axis (Space)**: Position `x ∈ [0,2]`.
- **Y-axis (Time)**: Evolving from `t = 0` (bottom) to `t = 2` (top).
- **Color (Amplitude `u`)**: Bright regions = high amplitude (pulse location).

**Why Diagonal Stripes?**  
The pulse starts near `x = 1` at `t = 0`. Since `c = 1`, after `t = 1`, it wraps around and reappears at `x = 0`. The slope of the stripes in the heatmap equals `1/c` (here, `1/1 = 1`). If `c` were larger, the stripes would be **steeper**.

**Tips & Variations**
----------------------

- **Change `c`**: Try `c = 0.5` or `c = 2`. Observe how the stripe slope changes.
- **Non-periodic boundaries**: Set `u(0,t) = 0` or use Neumann conditions.
- **Different initial shapes**: Replace `exp(-((x_grid - 1) / 0.1)^2)` with `sin(2*pi*x_grid)` for a traveling sine wave.
- **Add noise**: Initialize with `u_matrix[1, ] <- exp(-((x_grid - 1) / 0.1)^2) + rnorm(Nx, sd = 0.01)`.

Now, run the code, and voilà! You'll have a stunning Space-Time waterfall plot visualizing the advection equation in action. Happy coding!